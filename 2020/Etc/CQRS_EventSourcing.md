# CQRS와 이벤트소싱

공부하는 대로 내용을 추가할 예정입니다.

## 이벤트소싱

이벤트소싱은 데이터 저장 방식에 관한 것. 이벤트소싱은 기존에 해왔던 데이터를 저장하는 것이 아닌 순차적으로 발생하는 이벤트 자체를 모두 저장한다.

E-Commerce 개발을 하면서 흔히 볼 수 있는 로직이, 장바구니에 상품을 추가하고 삭제하는 로직이다. 이를 예시로 살펴보면..

1. 전기밥솥을 장바구니에 넣는다. (전기밥솥을 Order 객체에 넣는다)
2. 쌀을 장바구니에 넣는다. (쌀을 Order 객체에 넣는다)
3. 알고보니 전기밥솥이 있어서 전기밥솥을 뺀다. (기존의 Order객체에서 전기밥솥을 뺀다)

그러면 기존의 데이터 저장 방식에서는 Order객체에 쌀만 남아있는 상태일 것이다. 그러나 이벤트소싱 방식에서는 다음처럼 생각하면 된다.

1. 전기밥솥을 장바구니에 넣는다.
2. 쌀을 장바구니에 넣는다.
3. 전기밥솥을 장바구니에서 뺀다.

이런 이벤트 자체를 데이터로 저장하는 것이다.

그래서 이벤트소싱에는 Update나 Delete가 없다. 장바구니에서 빼는 일조차 하나의 이벤트로서 새로 추가되는 것이기 때문이다.

## CQRS (Command Query Responsibility Separation)

상태를 변경하는 Command와 조회하는 Query를 시스템, 또는 Object 단위로 분리시킨다. 그래서 CQRS와 이벤트소싱이 하나로 묶여서 언급되는 것 같다.

적용하는 방식은 다음과 같다.

1. Data store에 command와 query 모델을 분리된 계층으로 나누는 방식
    - 각자의 도메인 Layer에 대해서만 나누면 되기 때문에 단순하게 구현 가능
2. Database를 Command용 DB와 Query용 DB로 나누고 별도의 장치로 둘 간의 데이터를 동기화 하는 것
    - 각 모델에 맞게 데이터베이스를 튜닝할 수 있다.
3. 이벤트소싱을 적용한 모델
    - 이벤트스트림은 추가만 가능하고, 이렇게 쌓인 이벤트스트림을 구체화시키는 방식으로 조회 대상 데이터를 관리한다.

## 참고자료

- [medium 글](https://medium.com/@mjspring/%EC%9D%B4%EB%B2%A4%ED%8A%B8-%EC%86%8C%EC%8B%B1-event-sourcing-%EA%B0%9C%EB%85%90-50029f50f78c)
- [심천보님 글](https://www.popit.kr/cqrs-eventsourcing/)
