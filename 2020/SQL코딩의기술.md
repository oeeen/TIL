# 데이터 모델 설계

## 모든 테이블에 기본키가 있는지 확인하자

Primary key가 없으면 반복적이고 일관성 없는 데이터가 쌓여서 쿼리 수행 속도가 느리다.

어떤 키를 PK로 설정할까?

1. Unique
2. Not null
3. 안정적인 값(값을 갱신할 필요 없음)
4. 가능한 한 간단한 형태

RDB에서 참조 무결성 개념이 매우 중요하다.

그럼 참조 무결성은 무엇이냐

### 참조 무결성

참조 무결성(referential integrity)은 관계 데이터베이스 관계 모델에서 2개의 관련 있던 관계 변수(테이블) 간의 일관성(데이터 무결성)을 말한다. 참조 무결성은 종종 기본 키 또는 키가 아닌 후보 키와 외래 키의 조합으로 강제 적용된다. 참조 무결성이 강제 적용되면 외래 키가 선언된 관계 변수의 외래 키를 구성하는 속성(열)의 값은 그 관계 변수의 부모가 되는 관계 변수의 기본 키 값 또는 기본 키가 아닌 후보 키 값으로 존재해야 한다. 예를 들어, 다른 관계 변수의 외래 키에 의해 참조되는 쌍(dupe 행)을 제거하는 것은 참조 무결성을 파괴해 버리게 되기 때문에 관계 데이터베이스 관리 시스템(RDBMS) 참조 무결성을 유지하도록 일반적으로 삭제를 방지한다. 예외적으로 참조하는 외래 키를 포함하는 쌍을 연결하고 제거하는 것이 수반되어 삭제를 수행할 수 있으며,이 경우 참조 무결성이 유지된다. 외부 키에 의해 참조되는 듀프를 제거할 수 있는 지 여부는 데이터 정의 언어(DDL)에 의한 참조 무결성 제약 조건(constraint)에 의해 정의된다. (위키백과)

그러니까 pk와 fk의 조합으로 적용된다. 한 테이블의 fk로 선언된 열은 부모 테이블의 pk또는 후보 키 값으로 존재해야 한다.

전에 들었던 예시로 살펴보자.

### Employee Table

EmployeeId | Name | DepartmentId
--- | --- | ---
1 | Martin | 21
2 | Seongmo | 22
3 | Seonghwan | 23
4 | Pobi | 24
5 | Woni | 24
6 | Jun | 24
7 | Brown | Null

#### Department Table

Name | DepartmentId
--- | ---
영업부 | 21
마케팅 | 22
기획실 | 23
개발실 | 24
신사업부 | 25

Employee Table에 Insert시 (8, Downy, 26)을 하려고 한다면 EmployeeId 8은 들어갈 수 있지만, DepartmentId 26은 참조하고 있는 Department Table에 없기 때문에 불가능하다.

Delete에서는 Department Table에서 지울 때 문제가 생길 수 있다. 만약 영업부를 지운다고 하면, 영업부에 속한 Martin이라는 Employee는 어떻게 해야할지 모를 것이다. 그래서 이 때 삭제하는 방법이 있는데 작업을 취소하거나, Cascade, 미리 설정해둔 부서로 변경, null을 허용했다면 null로 변경 같은 방식이 있다.
